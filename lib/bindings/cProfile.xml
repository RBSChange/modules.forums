<?xml version="1.0" encoding="UTF-8"?>
<bindings xmlns="http://www.mozilla.org/xbl" xmlns:xbl="http://www.mozilla.org/xbl" xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
	<binding id="cForumsProfile">
		<resources>
			<stylesheet src="modules.uixul.cFieldsGroup" />
		</resources>
		<content>
			<xul:groupbox flex="1">
				<xul:caption label="${trans:m.forums.document.forumsprofile.document-name,attr,ucf}" />
				<xul:grid flex="1">
					<xul:columns>
						<xul:column />
						<xul:column flex="1" />
					</xul:columns>
					<xul:rows>
						<xul:row anonid="row_forumMemberTitle">
							<xul:clabel id="forums_forumsprofile_forumMemberTitle_label" control="forums_forumsprofile_forumMemberTitle"
								value="${trans:m.forums.document.forumsprofile.forummembertitle,attr,ucf}" />
							<xul:cfield name="forumMemberTitle" id="forums_forumsprofile_forumMemberTitle" anonid="field_forumMemberTitle"
								fieldtype="checklist" listid="modules_forums/titlesbywebsiteid"
								shorthelp="${trans:m.forums.document.forumsprofile.forummembertitle-help,attr}" />
						</xul:row>
						<xul:row anonid="row_signature">
							<xul:clabel id="forums_forumsprofile_signature_label" control="forums_forumsprofile_signature"
								value="${trans:m.forums.document.forumsprofile.signature,attr,ucf}" />
							<xul:cfield name="signature" id="forums_forumsprofile_signature" anonid="field_signature" fieldtype="bbcode"
								hidehelp="true" />
						</xul:row>
					</xul:rows>
				</xul:grid>
				<children />
			</xul:groupbox>
		</content>
		<implementation>
			<field name="mFields" />
			<field name="mId" />

			<constructor><![CDATA[
				this.mFields = null;
				this.mId = null;
				wCore.debug('cForumsProfile.constructor');
				this.parentNode.registerProfile(this);
			]]></constructor>

			<method name="getElementByAnonId">
				<parameter name="anonId" />
				<body><![CDATA[
					return document.getAnonymousElementByAttribute(this, "anonid", anonId);
				]]></body>
			</method>

			<property name="fields" readonly="true">
				<getter><![CDATA[
					if (this.mFields == null)
					{
						var fieldsNames = ["forumMemberTitle", "signature"];
						this.mFields = {};
						var field = null;
						var name = null;
						for (var i = 0; i < fieldsNames.length; i++)
						{
							name = fieldsNames[i];
							field = this.getElementByAnonId('field_' + name);
							this.mFields[name] = field;
						}
					}
					return this.mFields;
				]]></getter>
			</property>

			<method name="setValues">
				<parameter name="values" />
				<body><![CDATA[
					this.mId = values.id;
					var fields = this.fields;
					var field = null;				
					for (var name in fields)
					{
						fields[name].setInitialValue((name in values) ? values[name] : '');
					}
				]]></body>
			</method>

			<method name="getValues">
				<parameter name="values" />
				<body><![CDATA[
					var values = {"id" : this.mId};
					var fields = this.fields;
					var field = null;
					for (var name in fields)
					{
						if (fields[name].modified)
						{
							var val = fields[name].value;
							values[name] = (val === '') ?  null : val;
						}
					}
					return values;
				]]></body>
			</method>
		</implementation>
	</binding>
</bindings>